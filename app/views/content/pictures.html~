		<br><br>

		<h2>Pictures</h2>

<?php

// Config
$dirConf = "/public/Pictures/";	// Pictures directory, end it with a slash

$dir = $this->dirRoot . $dirConf;
$dirReq = str_replace("..", "", $_REQUEST["dir"]);	// dont let people go up one with ..
if ($dirReq)
	$dir = $dir . $dirReq;

$dirUrl = $this->rootUrl . substr($dir, (strlen($this->dirRoot) + 7), (strlen($dir) - strlen($this->dirRoot)));

echo "<p>Current Directory:<br>\n";
echo "/$dirReq</p><br>\n";

if ($dirReq != "")
	echo "<a href = \"" . $this->urlRoot . "/pictures.php?dir=" . $this->dirUp($dirReq) . "\">Go Back</a><br><br>\n";

$pics;
$dirs;

if (is_dir($dir))
{
    if ($dh = opendir($dir))
	{
		$i = 0;
        while (($file = readdir($dh)) != false)
		{
			if ((filetype($dir . $file) != "dir") && ($file != ".") && ($file != "..") && (substr_count($file, "jpg") || substr_count($file, "JPG")))
				$pics[$i] = $file;
			else if ((filetype($dir . $file) == "dir") && ($file != ".") && ($file != ".."))
				$dirs[$i] = $dirReq . $file;

			$i++;
		}
	}
}
else
	echo "ERROR: Invalid directory\n";

foreach ($dirs as $dir)
{
	echo  "<a href = \"" . $this->urlRoot . "/pictures.php?dir=$dir/\">$dir/</a><br>\n";
}

?>
<br>
<?php
foreach ($pics as $pic)
{
	echo "<a href = \"$dirUrl$pic\"><img src = \"magick.php?file=$dir$pic&x=600&y=0\" width = \"600\" height = \"450\"></a>
          <br><a href = \"$dirUrl$pic\">$pic</a><br><br>\n";
}

?>
        <br><br>
